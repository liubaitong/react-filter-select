"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var React=_interopDefault(require("react")),PropTypes=_interopDefault(require("prop-types")),ClassNames=_interopDefault(require("classnames")),immutable=require("immutable");function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css='.c-label {\n  font: 13px Arial,sans-serif;\n  vertical-align: middle;\n  display: inline-block;\n  line-height: 1.5em; }\n  .c-label input[type="checkbox"] {\n    display: none; }\n  .c-label .c-copy-checkbox {\n    cursor: pointer;\n    position: relative;\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    border: 1px solid #a9a9a9;\n    border-radius: 2px;\n    transition: ease .5s;\n    -webkit-animation: .36s ease-in-out;\n            animation: .36s ease-in-out;\n    -webkit-animation-fill-mode: both;\n            animation-fill-mode: both;\n    margin-right: 5px;\n    vertical-align: middle;\n    top: -.16em; }\n  .c-label .c-copy-checkbox:hover {\n      border-color: #41A9EF;\n      box-shadow: 0 0 3px 0 #41A9EF; }\n  .c-label .c-copy-checkbox:after {\n      position: absolute;\n      -webkit-transform: rotate(45deg) scale(1);\n              transform: rotate(45deg) scale(1);\n      left: 3px;\n      top: 0;\n      display: table;\n      width: 4px;\n      height: 8px;\n      border: 2px solid #fff;\n      border-top: 0;\n      border-left: 0;\n      content: " ";\n      transition: all 0.15s cubic-bezier(0.5, -0.45, 0.8, 0.5);\n      visibility: hidden; }\n  .c-label input[type="checkbox"]:checked + .c-copy-checkbox {\n    background: #41A9EF;\n    border: 1px solid #41A9EF; }\n  .c-label input[type="checkbox"]:checked + .c-copy-checkbox:after {\n      visibility: visible; }\n  .c-label .c-text {\n    display: inline-block;\n    cursor: pointer; }\n';styleInject(css);var _createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Checkbox=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("label",{className:"c-label"},React.createElement("input",{type:"checkbox",readOnly:!0,checked:this.props.checked,className:"c-checkbox"}),React.createElement("span",{className:"c-copy-checkbox"}),React.createElement("span",{className:"c-text"},this.props.children))}}]),t}();Checkbox.propTypes={checked:PropTypes.bool.isRequired};var css$1=".multi-select-wrap {\n  position: relative;\n  display: inline-block;\n  font-size: 13px; }\n  .multi-select-wrap p {\n    margin: 0; }\n  .multi-select-wrap input::-webkit-input-placeholder {\n    color: #666; }\n  .multi-select-wrap input:-moz-placeholder {\n    color: #666; }\n  .multi-select-wrap input::-moz-placeholder {\n    color: #666; }\n  .multi-select-wrap input:-ms-input-placeholder {\n    color: #666; }\n  .multi-select-wrap .text-overflow {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden; }\n  .multi-select-wrap .multi-input {\n    border: 1px solid #a9a9a9;\n    line-height: 30px;\n    height: 30px;\n    color: #666;\n    padding: 2px 5px;\n    box-sizing: content-box; }\n  .multi-select-wrap .multi-input.expanded, .multi-select-wrap .multi-input.expanded + .multi-dropdown {\n      border: 1px solid #41A9EF;\n      box-shadow: 0 0 5px #42a9ee; }\n  .multi-select-wrap .multi-input.expanded + .multi-dropdown {\n      border-top-color: #41a9ef; }\n  .multi-select-wrap .multi-input.expanded .icon {\n      -webkit-transform: rotate(135deg);\n              transform: rotate(135deg); }\n  .multi-select-wrap .multi-input .icon {\n      display: block;\n      content: '';\n      width: 7.5px;\n      height: 7.5px;\n      position: absolute;\n      right: .5rem;\n      top: 30%;\n      border-bottom: 1px solid #41A9EF;\n      border-left: 1px solid #41A9EF;\n      -webkit-transform: rotate(-45deg);\n              transform: rotate(-45deg);\n      transition: top .2s ease-out, -webkit-transform .3s ease-out;\n      transition: transform .3s ease-out, top .2s ease-out;\n      transition: transform .3s ease-out, top .2s ease-out, -webkit-transform .3s ease-out;\n      -webkit-transform-origin: 25% 75%;\n              transform-origin: 25% 75%;\n      cursor: pointer; }\n  .multi-select-wrap .multi-input span {\n      width: 90%;\n      display: inline-block; }\n  .multi-select-wrap .multi-dropdown {\n    position: absolute;\n    left: 0;\n    top: 35px;\n    z-index: 300;\n    overflow: auto;\n    background: #fff;\n    width: 100%;\n    box-sizing: border-box; }\n  .multi-select-wrap .multi-search {\n    width: 100%;\n    box-sizing: border-box;\n    line-height: 30px;\n    height: 30px;\n    color: #666;\n    padding: 2px 5px;\n    border: none; }\n  .multi-select-wrap .multi-search:focus {\n      outline: none; }\n  .multi-select-wrap .multi-list {\n    max-height: 200px;\n    overflow: auto; }\n  .multi-select-wrap .multi-line {\n    line-height: 30px;\n    height: 30px;\n    padding-left: 12px;\n    cursor: pointer; }\n  .multi-select-wrap .multi-line:hover {\n      background: #70bef3;\n      color: #fff; }\n  .multi-select-wrap.small .multi-input {\n    line-height: 24px;\n    height: 24px; }\n  .multi-select-wrap.small .multi-dropdown {\n    top: 29px; }\n  .multi-select-wrap.small .multi-search {\n    line-height: 24px;\n    height: 24px; }\n  .multi-select-wrap.small .icon {\n    top: 25%; }\n";styleInject(css$1);var _createClass$1=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$1(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var MultiSelect=function(e){function n(e){_classCallCheck$1(this,n);var t=_possibleConstructorReturn$1(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={expanded:!1,hasFocus:!1,search:"",checked:t.props.defaultChecked?[].concat(_toConsumableArray(t.props.defaultChecked)):[],options:[].concat(_toConsumableArray(t.props.options))||[],visibleSearch:!0},t.wrapper=Object,t}return _inherits$1(n,React.Component),_createClass$1(n,[{key:"componentWillMount",value:function(){var t=this,n=this;document.addEventListener("touchstart",function(e){return t.handleDocumentClick(e,n)}),document.addEventListener("mousedown",function(e){return t.handleDocumentClick(e,n)})}},{key:"componentWillReceiveProps",value:function(e){this.props.defaultChecked&&!immutable.fromJS(this.props.defaultChecked).equals(immutable.fromJS(e.defaultChecked))&&this.setState({checked:[].concat(_toConsumableArray(e.defaultChecked))}),immutable.fromJS(this.props.options).equals(immutable.fromJS(e.options))||this.setState({options:[].concat(_toConsumableArray(e.options))})}},{key:"handleDocumentClick",value:function(e,t){t.wrapper&&!t.wrapper.contains(e.target)&&t.setState({expanded:!1,search:""})}},{key:"handleFocus",value:function(e){var t=this.state.hasFocus;e.target===this.wrapper&&!t&&this.setState({hasFocus:!0})}},{key:"handleBlur",value:function(){this.state.hasFocus&&this.setState({hasFocus:!1})}},{key:"handleToggleExpanded",value:function(e){var t=this.state.expanded;if(!this.props.isLoading){var n=void 0===e?!t:e;this.setState({expanded:n,visibleSearch:n}),!n&&this.wrapper&&this.wrapper.focus()}}},{key:"handleChangeCheck",value:function(e,t){var n=this.state.checked,o=n.indexOf(e);-1<o?n.splice(o,1):n.push(e),this.setState({checked:n,visibleSearch:!1}),this.props.onchange(n),t.preventDefault()}},{key:"handleChangeCheckAll",value:function(e){var t=this.state,n=t.search,o=t.checked,i=t.options,a=0,r=0;0<i.length&&(i.map(function(e){-1<e.name.indexOf(n)&&(a++,-1<o.indexOf(e.id)&&r++)}),r<a?i.map(function(e){-1<e.name.indexOf(n)&&-1===o.indexOf(e.id)&&o.push(e.id)}):i.map(function(e){-1<e.name.indexOf(n)&&o.splice(o.indexOf(e.id),1)})),this.setState({checked:o,visibleSearch:0===a}),this.props.onchange(o),e.preventDefault()}},{key:"handleChangeSearch",value:function(e){this.setState({search:e})}},{key:"handleCustomAddOption",value:function(){if(this.props.allowAdd){var e=this.state,t=e.search,n=e.options;n.unshift({id:(new Date).getTime(),name:t}),this.setState({options:n})}}},{key:"render",value:function(){var o=this,e=this.state,t=e.expanded,n=e.hasFocus,i=e.search,a=e.checked,r=e.options,l=e.visibleSearch,s=a.length,c=this.props.selectedWordLength||0===this.props.selectedWordLength?this.props.selectedWordLength+1:4,p=r.length,u="",h=0,d=0,m=0,f=[];return r.map(function(t,e){var n=-1<a.indexOf(t.id);n&&(h++,s<c&&(u+=t.name+",")),-1!==t.name.indexOf(i)&&(n&&d++,m++,f.push(React.createElement("p",{key:e,className:"multi-line text-overflow",title:t.name,onClick:function(e){return o.handleChangeCheck(t.id,e)}},React.createElement(Checkbox,{checked:-1<a.indexOf(t.id),onClick:function(e){return o.handleChangeCheck(t.id,e)}},t.name))))}),0===f.length&&(f=React.createElement("p",{key:"empty",className:"multi-line",onClick:function(e){return o.handleCustomAddOption()}},React.createElement("span",{className:"multi-text"},0<p?this.props.allowAdd?"无匹配结果，回车或点击可添加":"无匹配数据":"无数据"))),u=h<c?u.substring(0,u.length-1):"已选中"+h+"个选项",p===h&&(u=0===p?"请选择":"全选"),React.createElement("div",{className:ClassNames({"multi-select-wrap":!0,small:this.props.size&&"small"===this.props.size}),ref:function(e){return o.wrapper=e},onFocus:this.handleFocus.bind(this),onBlur:this.handleBlur.bind(this)},React.createElement("div",{className:ClassNames({"multi-input":!0,expanded:t,focus:n}),style:{width:this.props.width||"248px"}},React.createElement("input",{type:"text",value:l?i:"",className:"multi-search",placeholder:u||this.props.placeholder||"请选择",onFocus:function(e){return o.handleToggleExpanded(!0)},onChange:function(e){return o.handleChangeSearch(e.target.value)}}),React.createElement("i",{className:"icon"})),t&&React.createElement("div",{className:"multi-dropdown"},React.createElement("p",{key:"all",className:"multi-line",onClick:function(e){return o.handleChangeCheckAll(e)}},React.createElement(Checkbox,{checked:0<p&&0<m&&m===d,onClick:function(e){return o.handleChangeCheckAll(e)}},"全选/全不选")),React.createElement("div",{className:"multi-list"},f)))}}]),n}();MultiSelect.propTypes={options:PropTypes.array.isRequired,defaultChecked:PropTypes.array,onchange:PropTypes.func,selectedWordLength:PropTypes.number,allowAdd:PropTypes.bool,size:PropTypes.string},module.exports=MultiSelect;
